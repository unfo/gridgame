<html>
<head>
    <title>The Grid Game</title>

    <style>
        svg { margin: -3; padding: 0; }
        #grid-container {
            display: none;
            background: white;
            margin-top: 2em;
        }

    </style>
</head>
<body>
<input type="number" id="gridsize" value="5"/> <button id="create-grid">Create grid</button>
<template id="svg-holder">
        <svg xmlns="http://www.w3.org/2000/svg" class="boxtemplate" viewBox="0 0 100 100" style="border: 1px dashed lightgrey">
            <style>
                polygon {
                    fill: white;

                }
                polygon:hover {
                    fill: red !important;
                    opacity: 1;
                }
                </style>
                <polygon points="0,0 50,50 100,0" data-side="up"/>
                <polygon points="100,0 50,50 100,100" data-side="right"/>
                <polygon points="0,0 50,50 0,100" data-side="left" />
                <polygon points="0,100 50,50 100,100" data-side="down"/>
         </svg>
</template>

<div id="grid-container"></div>
</body>
<script>
    var eventTarget = null;
        document.querySelector('#create-grid').addEventListener('click', function(event) {
            console.log('clicked');
            var grid = document.querySelector('#grid-container');
            grid.innerHTML = "";
            var gridsize = parseInt(document.querySelector('#gridsize').value, 10);
            var maxw = window.innerWidth;
            var maxh = window.innerHeight;
            if (maxw > maxh) {
                var gridpx = Math.ceil(maxh * 0.8);
            } else {
                var gridpx = Math.ceil(maxw * 0.8);
            }
            var size = Math.floor(gridpx / gridsize);
            grid.style.width   = (gridpx) + "px";
            grid.style.height  = (gridpx) + "px";
            grid.style.display = "block";
            
            function polyClicked(event) {
                eventTarget = event;
                var direction = event.target.dataset.side;
                var dataset = event.target.parentNode.dataset;
                console.log("Poly clicked on [", direction, "] on grid [", dataset.col, ',', dataset.row, ']');
                console.log(event);
                return true;
            }
            
            for (let row = 0; row < gridsize; row++) {
                for (let col = 0; col < gridsize; col++) {
                    let clone = document.querySelector('#svg-holder').content.cloneNode(true);
                    clone.firstElementChild.style.width = size + "px";
                    clone.firstElementChild.style.height = size + "px";
                    clone.firstElementChild.setAttribute('data-row', row);
                    clone.firstElementChild.setAttribute('data-col', col);
                    for (let poly of clone.querySelectorAll('polygon')) {
                        poly.addEventListener('click', polyClicked);
                    }
                    grid.appendChild(clone);
                }
            }
            event.preventDefault();
            return false;
        });
        
    </script>
</html>